<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Gestão de Contratos </title>
    <style>
        /* Estilos básicos de página */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        /* Estilo para o cabeçalho */
        header {
            background-color: #333;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        /* Estilo para o menu de navegação */
        nav {
            background-color: #444;
            display: flex;
            justify-content: space-between; /* Distribui os itens do menu de navegação */
            padding: 0;
        }

        /* Estilo para as listas de navegação (ul) */
        nav ul {
            list-style-type: none; /* Remove os marcadores de lista */
            margin: 0;
            padding: 0;
            display: flex;
        }

        /* Estilo para os itens da lista de navegação */
        nav ul li {
            margin: 0;
        }

        /* Estilo para os links de navegação */
        nav ul li a {
            display: block;
            color: white;
            text-align: center;
            padding: 14px 20px;
            text-decoration: none;
        }

        /* Estilo para mudar a cor ao passar o mouse */
        nav ul li a:hover {
            background-color: #555;
        }

        /* Estilo do conteúdo principal da página */
        main {
            padding: 2rem;
            text-align: center;
        }

        /* Estilos para os campos de input dos formulários */
        .input-group {
            margin: 10px 0;
        }

        label {
            margin-right: 10px;
        }

        /* Esconde os formulários inicialmente */
        #formulario-fornecedor, #formulario-contrato {
            display: none;
        }

        /* Estilo para os botões */
        .button {
            padding: 10px 20px;
            background-color: #444;
            color: white;
            border: none;
            cursor: pointer;
            margin: 10px;
        }

        .button:hover {
            background-color: #555;
        }
    </style>
</head>
<body>
<!-- Cabeçalho da página com o título -->
<header>
    <h1>Gestão de Contratos - Cadastro</h1>
</header>

<!-- Menu de navegação horizontal com as opções "Fornecedor", "Contrato" e "Home" -->
<nav>
    <ul>
        <!-- Botão que exibe o formulário de Fornecedor ao ser clicado -->
        <li><a href="#" onclick="exibirFormulario('fornecedor')">Fornecedor</a></li>
        <!-- Botão que exibe o formulário de Contrato ao ser clicado -->
        <li><a href="#" onclick="exibirFormulario('contrato')">Contrato</a></li>
    </ul>
    <ul>
        <!-- Botão que redireciona para a página inicial -->
        <li><a href="index.html">Home</a></li> <!-- Botão Home -->
    </ul>
</nav>

<!-- Área principal onde os formulários serão exibidos -->
<main>
    <h2>Escolha uma das opções acima para cadastrar</h2>

    <!-- Formulário de cadastro de fornecedor (inicialmente escondido) -->
    <div id="formulario-fornecedor">
        <h3>Cadastro de Fornecedor</h3>
        <div class="input-group">
            <label for="nome-fornecedor">Nome:</label>
            <input type="text" id="nome-fornecedor" placeholder="Nome do Fornecedor">
        </div>
        <div class="input-group">
            <label for="codigo-fornecedor">Código:</label>
            <input type="text" id="codigo-fornecedor" placeholder="Código do Fornecedor">
        </div>
        <div class="input-group">
            <label for="conta-fornecedor">Conta:</label>
            <input type="number" id="conta-fornecedor" placeholder="Conta de Despesa">
        </div>
        <!-- Botão para adicionar fornecedor -->
        <button class="button" onclick="adicionarFornecedor()">Adicionar Fornecedor</button>
    </div>

    <!-- Formulário de cadastro de contrato (inicialmente escondido) -->
    <div id="formulario-contrato">
        <h3>Cadastro de Contrato</h3>
        <div class="input-group">
            <label for="numparcelas">Número de Parcelas:</label>
            <input type="number" id="numparcelas" placeholder="Número de Parcelas">
        </div>
        <div class="input-group">
            <label for="data-inicio">Data de Início:</label>
            <input type="date" id="data-inicio">
        </div>
        <div class="input-group">
            <label for="data-fim">Data de Fim:</label>
            <input type="date" id="data-fim">
        </div>
        <div class="input-group">
            <label for="valor">Valor:</label>
            <input type="number" id="valor" placeholder="Valor do Contrato">
        </div>
        <div class="input-group">
            <label for="objeto">Objeto do Contrato:</label>
            <input type="text" id="objeto" placeholder="Objeto do Contrato">
        </div>
        <!-- Dropdown para selecionar um fornecedor já cadastrado -->
        <div class="input-group">
            <label for="fornecedor-contrato">Fornecedor:</label>
            <select id="fornecedor-contrato"></select>
        </div>
        <!-- Botão para adicionar contrato -->
        <button class="button" onclick="adicionarContrato()">Adicionar Contrato</button>
    </div>
</main>

<script>
    // Função que exibe o formulário de acordo com a opção selecionada (Fornecedor ou Contrato)
    function exibirFormulario(formulario) {
        // Obtém os elementos do DOM referentes aos formulários de fornecedor e contrato
        const formFornecedor = document.getElementById('formulario-fornecedor');
        const formContrato = document.getElementById('formulario-contrato');

        // Verifica qual formulário deve ser exibido com base no parâmetro 'formulario'
        if (formulario === 'fornecedor') {
            // Exibe o formulário de fornecedor e oculta o de contrato
            formFornecedor.style.display = 'block';
            formContrato.style.display = 'none';
        } else if (formulario === 'contrato') {
            // Exibe o formulário de contrato e oculta o de fornecedor
            formFornecedor.style.display = 'none';
            formContrato.style.display = 'block';
            // Carrega a lista de fornecedores cadastrados ao exibir o formulário de contrato
            carregarFornecedores();
        }
    }

    // Função assíncrona para adicionar um novo fornecedor ao sistema (envia dados ao back-end)
    async function adicionarFornecedor() {
        // Obtém os valores dos campos de input do formulário de fornecedor
        const for_nome = document.getElementById('nome-fornecedor').value;
        const cod_fornecedor = document.getElementById('codigo-fornecedor').value;
        const cont_despesa = document.getElementById('conta-fornecedor').value;

        // Envia uma requisição POST para o back-end com os dados do fornecedor
        await fetch('/fornecedor', {

            method: 'POST',  // Define o méeodo HTTP como POST
            headers: { 'Content-Type': 'application/json' },  // Especifica o tipo de conteúdo como JSON
            body: JSON.stringify({for_nome, cod_fornecedor, cont_despesa})  // Converte os dados do fornecedor para JSON e envia no corpo da requisição
        });

        // Exibe uma mensagem de sucesso após o fornecedor ser adicionado
        alert('Fornecedor adicionado com sucesso!');
    }

    // Função assíncrona que carrega a lista de fornecedores e a exibe no dropdown do contrato
    async function carregarFornecedores() {
        // Faz uma requisição GET para o back-end para buscar a lista de fornecedores cadastrados
        const response = await fetch('/fornecedor');
        const fornecedores = await response.json(); // Converte a resposta para JSON

        // Seleciona o elemento de dropdown do formulário de contrato
        const select = document.getElementById('fornecedor-contrato');
        select.innerHTML = ''; // Limpa o dropdown antes de adicionar novos fornecedores

        // Itera sobre a lista de fornecedores e adiciona cada um como uma opção no dropdown
        fornecedores.forEach(fornecedor => {
            const option = document.createElement('option'); // Cria um novo elemento de opção
            option.value = fornecedor.id_fornecedor; // Define o valor da opção como o ID do fornecedor
            option.text = fornecedor.for_nome; // Define o texto da opção como o nome do fornecedor
            select.appendChild(option); // Adiciona a opção ao dropdown
        });
    }

    // Função assíncrona para adicionar um novo contrato ao sistema (envia dados ao back-end)
    async function adicionarContrato() {
        // Obtém os valores dos campos de input do formulário de contrato
        const id_fornecedor = document.getElementById('fornecedor-contrato').value;
        const num_parcelas = document.getElementById('numparcelas').value;
        const dt_inicio = document.getElementById('data-inicio').value;
        const dt_fim = document.getElementById('data-fim').value;
        const vlr_contrato = document.getElementById('valor').value;
        const ctto_objeto = document.getElementById('objeto').value;
        const contrato = {
            id_fornecedor: id_fornecedor,
            num_parcelas: num_parcelas,
            dt_inicio: dt_inicio,
            dt_fim: dt_fim,
            vlr_contrato: vlr_contrato,
            ctto_objeto: ctto_objeto
        }

        // Envia uma requisição POST para o back-end com os dados do contrato
        await fetch('/contrato', {
            method: 'POST',  // Define o metodo HTTP como POST
            headers: { 'Content-Type': 'application/json' },  // Especifica o tipo de conteúdo como JSON
            body: JSON.stringify(contrato)  // Converte os dados do contrato para JSON e envia no corpo da requisição
        });

        // Exibe uma mensagem de sucesso após o contrato ser adicionado
        alert('Contrato adicionado com sucesso!');
    }
</script>
</body>
</html>
